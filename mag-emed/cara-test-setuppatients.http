### Tests scripts to create demo patients
### 1. Create a simulated saml token saml-patient-[id].xml with patient id inside
###    Encode it to base64 -> saml-patient-[id].64.txt
### 2. Create an APPC document for the patient -> appc-2.999.756.42.2-[id].xml with patient id inside
###    Encode it to base64 -> appc-2.999.756.42.2-[id].64.txt
### 3. Create Provide Document Bundle request
###    appc-2.999.756.42.2-[mhd].mhd.json
###    - check that local patient is added
###    - verify that all identifier/masterIdendifiter uuid's are unique
###    - update the Binary.data with appc-2.999.756.42.2-[id].64.txt
### 3. Add a  POST fhir request and use for the Auhtorization Header IHE-SAML: saml-patient-[id].64.txt
###    actually this saml token ist wrong, should contain EPR-SPID
###    EPR-SPID are currently fix defined to map to local patients see [testsetup](testsetupcara.md)


@host = http://localhost:9090/mag-pmp
### @host = https://test.ahdis.ch/mag-pmp

### Find Document References from PMP for non existing patient CARAEMED001 no auth
### --> 400: The patient ID in the search query does not match the auth
### Find Document References from PMP for non existing patient CARAEMED001 with auth
### --> 400: The patient is unknown to this community."


### CARAEMED001: Setup a new patient

POST {{host}}/fhir/ HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwMV5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

< ./pmp-pharm/appc-2.999.756.42.2-CARAEMED001.mhd.json

### Find Document References for Patient CARAEMED001 adding xua token
GET {{host}}/fhir/DocumentReference?status=current&patient.identifier=urn:oid:2.999.756.42.2|CARAEMED001 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwMV5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

### ITI-83 pixm call to https://ehealthsuisse.ihe-europe.net/PatientManager/patient/allPatients.seam?date=ANY|1597321706550|1597321706550&testData=false

GET {{host}}/fhir/Patient/$ihe-pix?sourceIdentifier=urn:oid:1.3.6.1.4.1.21367.2017.2.5.83|MAGMED001&targetSystem=urn:oid:2.999.756.42.21&targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json


### CARAEMED002: Setup a new patient
POST {{host}}/fhir/ HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwMl5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

< ./pmp-pharm/appc-2.999.756.42.2-CARAEMED002.mhd.json

### Feed ITI-93 PRIM patient identity feed for PatientManager - Update existing Gazelle patient with local id's
POST {{host}}/fhir/$process-message HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

< ./pmp-pharm/patientfeed-CARAMED002.json

### ITI-83 pixm call to https://ehealthsuisse.ihe-europe.net/PatientManager/patient/allPatients.seam?date=ANY|1597321706550|1597321706550&testData=false

GET {{host}}/fhir/Patient/$ihe-pix?sourceIdentifier=urn:oid:1.3.6.1.4.1.21367.2017.2.5.83|MAGMED002&targetSystem=urn:oid:2.999.756.42.21&targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

###
GET {{host}}/fhir/DocumentReference?status=current&patient.identifier=urn:oid:2.999.756.42.2|CARAEMED002 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwMl5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

### CARAEMED003: Setup a new patient

POST {{host}}/fhir/ HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwM15eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

< ./pmp-pharm/appc-2.999.756.42.2-CARAEMED003.mhd.json

###
GET {{host}}/fhir/DocumentReference?status=current&patient.identifier=urn:oid:2.999.756.42.2|CARAEMED003 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwM15eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

### Feed ITI-93 PRIM patient identity feed for PatientManager - Update existing Gazelle patient with local id's
POST {{host}}/fhir/$process-message HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

< ./pmp-pharm/patientfeed-CARAMED003.json

### ITI-83 pixm call to https://ehealthsuisse.ihe-europe.net/PatientManager/patient/allPatients.seam?date=ANY|1597321706550|1597321706550&testData=false

GET {{host}}/fhir/Patient/$ihe-pix?sourceIdentifier=urn:oid:1.3.6.1.4.1.21367.2017.2.5.83|MAGMED003&targetSystem=urn:oid:2.999.756.42.21&targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

### CARAEMED004: Setup a new patient

POST {{host}}/fhir/ HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwNF5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

< ./pmp-pharm/appc-2.999.756.42.2-CARAEMED004.mhd.json


### Feed ITI-93 PRIM patient identity feed for PatientManager - Update existing Gazelle patient with local id's
POST {{host}}/fhir/$process-message HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

< ./pmp-pharm/patientfeed-CARAMED004.json

### ITI-83 pixm call to https://ehealthsuisse.ihe-europe.net/PatientManager/patient/allPatients.seam?date=ANY|1597321706550|1597321706550&testData=false

GET {{host}}/fhir/Patient/$ihe-pix?sourceIdentifier=urn:oid:1.3.6.1.4.1.21367.2017.2.5.83|MAGMED004&targetSystem=urn:oid:2.999.756.42.21&targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

###
GET {{host}}/fhir/DocumentReference?status=current&patient.identifier=urn:oid:2.999.756.42.2|CARAEMED004 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwNF5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

### CARAEMED005: Setup a new patient

POST {{host}}/fhir/ HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwNV5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

< ./pmp-pharm/appc-2.999.756.42.2-CARAEMED005.mhd.json

###
GET {{host}}/fhir/DocumentReference?status=current&patient.identifier=urn:oid:2.999.756.42.2|CARAEMED005 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBRU1FRDAwNV5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+


### Feed ITI-93 PRIM patient identity feed for PatientManager - Update existing Gazelle patient with local id's
POST {{host}}/fhir/$process-message HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

< ./pmp-pharm/patientfeed-CARAMED005.json

### ITI-83 pixm call to https://ehealthsuisse.ihe-europe.net/PatientManager/patient/allPatients.seam?date=ANY|1597321706550|1597321706550&testData=false

GET {{host}}/fhir/Patient/$ihe-pix?sourceIdentifier=urn:oid:1.3.6.1.4.1.21367.2017.2.5.83|MAGMED005&targetSystem=urn:oid:2.999.756.42.21&targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json

### CARATEST001: Setup a new patient

POST {{host}}/fhir/ HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBVEVTVDAwMV5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

< ./pmp-pharm/appc-2.999.756.42.2-CARATEST001.mhd.json

### Find Document References from PMP for patient CARATEST001
GET {{host}}/fhir/DocumentReference?status=current&patient.identifier=urn:oid:2.999.756.42.2|CARATEST001 HTTP/1.1
Accept: application/fhir+json
Content-Type: application/fhir+json
Authorization: IHE-SAML PHNhbWwyOkFzc2VydGlvbiB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9IkFzc2VydGlvbl8zZWZiZmM3OTE3YTFkM2VjNmUzM2VjNzBmNDEwMzkzZDY1NTk4MGJiIiBJc3N1ZUluc3RhbnQ9IjIwMjAtMDgtMjhUMDk6MDE6MDYuNDIxWiIgVmVyc2lvbj0iMi4wIj4KICAgIDxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZSBOYW1lPSJ1cm46b2FzaXM6bmFtZXM6dGM6eGFjbWw6Mi4wOnN1YmplY3Q6cm9sZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPgogICAgICAgICAgICA8c2FtbDI6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzZDphbnlUeXBlIj4KICAgICAgICAgICAgICAgIDxobDd2MzpSb2xlIHhtbG5zOmhsN3YzPSJ1cm46aGw3LW9yZzp2MyIgY29kZT0iUEFUIiBjb2RlU3lzdGVtPSIyLjE2Ljc1Ni41LjMwLjEuMTI3LjMuMTAuNiIgZGlzcGxheU5hbWU9IlBhdGllbnQiLz4KICAgICAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgICA8L3NhbWwyOkF0dHJpYnV0ZT4KICAgICAgICA8c2FtbDI6QXR0cmlidXRlIE5hbWU9InVybjpvYXNpczpuYW1lczp0Yzp4YWNtbDoyLjA6cmVzb3VyY2U6cmVzb3VyY2UtaWQiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj4KICAgICAgICAgICAgPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj5DQVJBVEVTVDAwMV5eXiZhbXA7Mi45OTkuNzU2LjQyLjImYW1wO0lTTzwvc2FtbDI6QXR0cmlidXRlVmFsdWU+CiAgICAgICAgPC9zYW1sMjpBdHRyaWJ1dGU+CiAgICA8L3NhbWwyOkF0dHJpYnV0ZVN0YXRlbWVudD4KPC9zYW1sMjpBc3NlcnRpb24+

###
GET {{host}}/camel/xdsretrieve?uniqueId=urn:uuid:4492c812-5388-45af-a4ad-71ee994f32bd&repositoryUniqueId=2.999.756.42.1 HTTP/1.1

